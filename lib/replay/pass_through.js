// Generated by CoffeeScript 1.8.0
var HTTP, HTTPS, passThrough;

HTTP = require("http");

HTTPS = require("https");

passThrough = function(passThrough) {
  var boolean, hostname, _ref, _ref1;
  if (arguments.length === 0) {
    passThrough = function() {
      return true;
    };
  } else if (typeof passThrough === "string") {
    _ref = [
      passThrough, function(request) {
        return request.hostname === hostname;
      }
    ], hostname = _ref[0], passThrough = _ref[1];
  } else if (typeof passThrough !== "function") {
    _ref1 = [
      passThrough, function(request) {
        return !!boolean;
      }
    ], boolean = _ref1[0], passThrough = _ref1[1];
  }
  return function(request, callback) {
    var http, options, part;
    if (passThrough(request)) {
      options = {
        protocol: request.url.protocol,
        hostname: request.url.hostname,
        port: request.url.port,
        path: request.url.path,
        method: request.method,
        headers: request.headers,
        agent: request.agent,
        auth: request.auth
      };
      http = new HTTP.ClientRequest(options);
      if (request.trailers) {
        http.addTrailers(request.trailers);
      }
      http.on("error", function(error) {
        return callback(error);
      });
      http.on("response", function(response) {
        var captured;
        captured = {
          version: response.httpVersion,
          statusCode: response.statusCode,
          statusMessage: response.statusMessage,
          headers: response.headers,
          rawHeaders: response.rawHeaders,
          body: []
        };
        response.on("data", function(chunk, encoding) {
          return captured.body.push([chunk, encoding]);
        });
        return response.on("end", function() {
          captured.trailers = response.trailers;
          captured.rawTrailers = response.rawTrailers;
          return callback(null, captured);
        });
      });
      if (request.body) {
        for (part in request.body) {
          http.write(part[0], part[1]);
        }
      }
      return http.end();
    } else {
      return callback(null);
    }
  };
};

module.exports = passThrough;
